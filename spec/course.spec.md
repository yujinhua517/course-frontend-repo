# 課程管理功能規格 (Course Management Specification) 
> 課程管理系統提供完整的課程資料管理功能，包含課程的增刪改查操作。基於 Angular 19+ 技術架構實現企業級課程管理，支援動態選項載入、權限控制、無障礙設計等現代化特性。
## Feature Name: course-management
## 🎯 功能概述
課程管理系統提供完整的課程管理功能，包含課程的增刪改查、檢視詳情、批量操作等。系統支援多元化課程類型管理、技能分級制度、學習方式分類等業務需求，並與課程活動系統整合運作。採用 Angular 19+ signals、standalone components 等現代化技術實現。

## 📋 功能清單
- **課程列表查詢** - 課程資料查詢與篩選，支援動態選項載入
- **課程新增功能** - 模態視窗新增課程，完整表單驗證
- **課程編輯功能** - 模態視窗編輯課程，預載現有資料
- **課程詳情檢視** - 模態視窗檢視課程完整資訊
- **課程刪除功能** - 單筆/批量刪除，含確認機制
- **狀態管理** - 課程啟用/停用狀態切換
- **資料匯出** - 查詢結果匯出功能
---

## 1. 課程查詢功能(Query)

### 🔍 查詢條件

| 欄位名稱 | 英文名稱 | 資料類型 | 必填 | 查詢方式 | 表單控制項 | 預設值 | 說明 |
|---------|---------|---------|------|---------|----------|--------|------|
| 課程活動 | courseEventId | 數字 | 否 | 精準查詢 | 下拉選單 | 全部 | 關聯的課程活動 |
| 課程名稱 | courseName | 文字 | 否 | 模糊查詢 | 文字輸入框 | 空白 | 課程名稱關鍵字 |
| 上課方式 | learningType | 文字(100) | 否 | 精準查詢 | 下拉選單 | 全部 | 實體/線上學習類型 |
| 技術類別 | skillType | 文字(20) | 否 | 精準查詢 | 下拉選單 | 全部 | 軟體力/數據力/雲端技術 |
| 等級 | level | 文字(10) | 否 | 精準查詢 | 下拉選單 | 全部 | 課程難度等級 |
| 是否啟用 | isActive | 布林值 | 否 | 精準查詢 | 下拉選單 | 啟用 | 啟用/停用/全部 |


### 放操作功能(BUTTON)，BUTTON 與查詢條件同一區塊，放在同一列
- **查詢** - 根據條件搜尋課程資料
- **新增** - 跳轉到課程新增頁面(未完成新增功能時，顯示訊息"施工中")
- **匯入** - 批量匯入課程資料(暫不實做)
- **匯入範例下載** - 下載匯入格式範例檔案(暫不實做)
- **匯出**: 下載查詢結果為 Excel 檔案(暫不實做)

### 📊 查詢結果

| 欄位名稱 | 英文名稱 | 資料類型 | 顯示 | 可排序 | 表單控制項 | 說明 |
|---------|---------|---------|------|--------|-----------|------|
| 課程名稱 | courseName | 文字 | ✓ | ✓ | - | 課程名稱 |
| 上課方式 | learningType | 文字(100) | ✓ | ✓ | - | 學習類型 |
| 技術類別 | skillType | 文字(20) | ✓ | ✓ | - | 技能分類 |
| 等級 | level | 文字(10) | ✓ | ✓ | - | 課程難度 |
| 是否啟用 | isActive | 布林值 | ✓ | ✓ | 開關切換 | 可直接切換狀態 |
| 建檔時間 | createTime | 日期時間 | ✓ | ✓ | - | 資料建立時間 |
| 功能按鈕 | - | - | ✓ | ✗ | 按鈕群組 | 修改/刪除操作 |

### 🎮 查詢結果中的操作功能
- **狀態切換**: 直接在列表中啟用/停用課程
- **修改**: 以courseId為參數，跳轉網頁至修改畫面(未完成編輯功能時，顯示訊息"施工中")
- **刪除**: 詢問是否刪除後，若同意刪除則刪除該筆課程
- **分頁**: 支援分頁瀏覽，可選擇每頁筆數
- **排序**: 點擊欄位標題進行排序

### 🔄 業務邏輯
1. **分頁規則**:
   - 預設每頁 10 筆資料
   - 支援 10/25/50/100 筆選項
   - 記住使用者的分頁偏好

2. **排序規則**:
   - 支援單欄位排序
   - 點擊欄位標題切換升序/降序
   - 預設按課程名稱升序排列

---

## 2. 課程新增功能(Create)

### 📝 表單欄位

| 欄位名稱 | 英文名稱 | 資料類型 | 必填 | 驗證規則 | 表單控制項 | 預設值 | 說明 |
|---------|---------|---------|------|---------|----------|--------|------|
| 課程活動 | courseEventId | 數字 | 是 | 必須選擇有效活動 | 下拉選單 | 請選擇 | 關聯的課程活動 |
| 課程名稱 | courseName | 文字 | 是 | 不可為空、最大長度限制 | 文字區域 | 空白 | 課程名稱 |
| 上課方式 | learningType | 文字(100) | 是 | 選擇有效選項 | 下拉選單 | 請選擇 | 實體/線上學習類型 |
| 技術類別 | skillType | 文字(20) | 是 | 選擇有效選項 | 下拉選單 | 請選擇 | 軟體力/數據力/雲端 |
| 等級 | level | 文字(10) | 是 | 選擇有效選項 | 下拉選單 | 請選擇 | 課程難度等級 |
| 時數 | hours | 數字 | 是 | 必須小於100 | 數字格式99.9 | 0 | 課程的時數 |
| 備註 | remark | 文字(255) | 否 | 最大255字 | 文字區域 | 空白 | 課程備註說明 |
| 是否啟用 | isActive | 布林值 | 是 | 預設為啟用 | 開關切換 | 啟用 | 課程狀態 |

### 🎮 操作功能
- **確認新增**: 提交表單建立新課程
- **重設**: 清空表單內容，回復預設值
- **取消**: 返回課程查詢列表頁面

### 🔄 業務邏輯
1. **驗證規則**:
   - 課程活動：必須選擇存在的課程活動
   - 課程名稱：不可為空白，支援長文字內容
   - 分類欄位：必須選擇預定義的有效選項
   - 時數：必須小於100

3. **新增流程**:
   - 驗證表單完整性
   - 檢查課程活動有效性
   - 建立課程資料
   - 自動設定建檔時間和建檔人員,建檔人員為系統登入者，為必要欄位
   - 成功後返回查詢頁面並顯示成功訊息

4. **錯誤處理**:
   - 顯示欄位驗證錯誤
   - 顯示關聯驗證錯誤
   - 顯示 API 錯誤訊息
   - 保持在新增頁面供修正

### 路由設定
- **路徑**: `/courses/create`
- **來源**: 從課程查詢頁面點擊「新增」按鈕
- **返回**: 成功新增後返回 `/courses`

---

## 3. 課程編輯功能(Edit)

### 📝 表單欄位

| 欄位名稱 | 英文名稱 | 資料類型 | 必填 | 驗證規則 | 表單控制項 | 預設值 | 說明 |
|---------|---------|---------|------|---------|----------|--------|------|
| 課程ID | courseId | 數字 | 是 | 系統自動產生 | 文字輸入框(唯讀) | 現有資料 | 系統唯一識別碼 |
| 課程活動 | courseEventId | 數字 | 是 | 必須選擇有效活動 | 下拉選單 | 現有資料 | 關聯的課程活動 |
| 課程名稱 | courseName | 文字 | 是 | 不可為空 | 文字區域 | 現有資料 | 課程名稱 |
| 上課方式 | learningType | 文字(100) | 是 | 有效選項 | 下拉選單 | 現有資料 | 學習類型 |
| 技術類別 | skillType | 文字(20) | 是 | 有效選項 | 下拉選單 | 現有資料 | 技能分類 |
| 等級 | level | 文字(10) | 是 | 有效選項 | 下拉選單 | 現有資料 | 課程難度 |
| 時數 | hours | 數字 | 是 | 必須小於100 | 數字格式99.9 | 現有資料 | 課程的時數 |
| 備註 | remark | 文字(255) | 否 | 最大255字 | 文字區域 | 現有資料 | 備註說明 |
| 是否啟用 | isActive | 布林值 | 是 | 布林值 | 開關切換 | 現有資料 | 啟用狀態 |

### 🔄 業務邏輯
- **載入現有資料**: 進入編輯頁面時載入課程完整資訊
- **主鍵限制**: 編輯模式下課程ID不可修改
- **審計追蹤**: 自動更新最後修改時間和修改人員，修改人員為系統登入者

### 路由設定
- **路徑**: `/courses/edits`
- **來源**: 從課程查詢頁面點擊「修改」按鈕
- **返回**: 成功編輯後返回 `/courses`

---

## 4. 課程匯入功能(暫不實做)

### 📝 匯入規格

| 項目 | 規格說明 |
|------|----------|
| 檔案格式 | Excel (.xlsx) |
| 檔案大小限制 | 最大 10MB |
| 資料筆數限制 | 單次最多 1000 筆 |
| 編碼格式 | UTF-8 |

### 📊 匯入檔案欄位格式

| Excel 欄位名稱 | 英文名稱 | 資料類型 | 必填 | 格式說明 | 範例值 |
|----------------|---------|----------|------|----------|--------|
| 課程活動名稱 | courseEventName | 文字 | 是 | 現有課程活動名稱 | 2025年上半年技術提升計畫 |
| 課程名稱 | courseName | 文字 | 是 | 完整課程名稱 | Angular 前端開發實戰 |
| 上課方式 | learningType | 文字 | 是 | 實體/線上/混合 | 線上 |
| 技術類別 | skillType | 文字 | 是 | 軟體力/數據力/雲 | 軟體力 |
| 等級 | level | 文字 | 是 | 入門/初級/中級/高級/專家 | 中級 |
| 時數 | hours | 數字 | 是 | 99.9 | 13.5 |
| 備註 | remark | 文字 | 否 | 最大255字 | 包含實作專案 |
| 是否啟用 | isActive | 文字 | 否 | 是/否，預設為是 | 是 |

### 🎮 操作功能
- **選擇檔案**: 選擇要匯入的 Excel 檔案
- **下載範例**: 下載匯入格式範例檔案
- **預覽資料**: 上傳後預覽將要匯入的資料
- **驗證檢查**: 檢查資料格式和業務規則
- **確認匯入**: 執行實際匯入操作
- **匯入結果**: 顯示匯入成功/失敗統計

### 🔄 業務邏輯

1. **檔案驗證**:
   - 檔案格式必須為 .xlsx
   - 檔案大小不得超過 10MB
   - 必須包含標題列（第一列）
   - 資料筆數不得超過 1000 筆

2. **資料驗證**:
   - 必填欄位不可為空
   - 課程活動名稱必須存在於系統中
   - 分類選項必須為預定義值
   - 同一課程活動下，課程名稱不可重複

3. **匯入流程**:
   - 上傳檔案並解析內容
   - 驗證資料格式和業務規則
   - 顯示預覽資料和驗證結果
   - 使用者確認後執行匯入
   - 顯示匯入結果統計

4. **錯誤處理**:
   - 顯示檔案格式錯誤
   - 列出資料驗證錯誤明細
   - 提供錯誤資料下載
   - 支援部分成功匯入

5. **匯入範例檔案內容**:
   ```
   課程活動名稱 |  課程名稱 | 上課方式 | 技術類別 | 等級 | 備註 | 是否啟用
   2025年上半年技術提升計畫 |  Angular 前端開發實戰 | 線上 | 軟體力 | 中級 | 包含實作專案 | 是
   2025年上半年技術提升計畫 |  Python 數據分析基礎 | 實體 | 數據力 | 初級 | 適合新手 | 是
   ```

### 路由設定
- **路徑**: `/courses/import`
- **來源**: 從課程查詢頁面點擊「匯入」按鈕
- **返回**: 匯入完成後返回 `/courses/query`

---

## 共用資料結構

### 上課方式選項
- **實體**: 現場實體授課
- **線上**: 遠距線上學習
- **混合**: 實體與線上混合模式

### 技術類別選項
- **軟體力**: 軟體開發相關技術
- **數據力**: 數據分析與處理技術
- **雲**: 雲端服務與架構技術

### 等級選項
- **基礎**: 基礎入門級別
- **進階**: 進階程度

### 狀態定義
- **啟用**: 課程正常開放中，可供報名學習
- **停用**: 課程暫停或已結束

### API 端點總覽
- **查詢列表**: `POST /api/courses/query` - 分頁查詢課程列表
- **新增資料**: `POST /api/courses/create` - 建立新課程
- **更新資料**: `POST /api/courses/update` - 更新現有課程（含狀態切換）
- **取得單筆**: `GET /api/courses/find/:courseId` - 取得特定課程詳情
- **刪除資料**: `POST /api/courses/delete` - 刪除課程
- **匯入資料**: `POST /api/courses/import` - 批量匯入課程資料
- **匯入範例下載**: `GET /api/courses/import/template` - 下載匯入範例檔案
- **匯出資料**: `POST /api/courses/export` - 匯出查詢結果為 Excel

---

## 📋 開發檢查清單

### 功能需求確認
- [ ] 查詢條件欄位確認 (課程名稱、分類、狀態)
- [ ] 查詢結果欄位確認 (包含所有主要欄位和操作按鈕)
- [ ] 新增表單欄位確認 (必填和選填欄位)
- [ ] 編輯表單欄位確認 (唯讀和可編輯欄位)
- [ ] 匯入功能欄位確認 (Excel格式和驗證規則)
- [ ] 驗證規則確認 (關聯性、長度、格式)
- [ ] 業務邏輯規則確認 (分類管理、狀態控制)
- [ ] API 端點規格確認

### 技術規範確認
- [x] 檔案結構符合 Angular 19+ standalone 標準
- [x] 使用 Angular 19+ signals (computed, resource, input, output)
- [x] 使用新版控制流語法 (@if, @for, @switch, @defer)
- [x] 所有組件使用 ChangeDetectionStrategy.OnPush
- [x] 使用 inject() 依賴注入
- [x] 命名約定一致 (camelCase for frontend)
- [x] 資料轉換規則 (snake_case ↔ camelCase)
- [x] 錯誤處理方式 (使用 HttpErrorHandlerService)
- [x] 響應式設計需求 (Bootstrap 5)
- [x] 無障礙性需求 (WCAG 2.1 AA)

### 業務邏輯確認
- [ ] 課程活動關聯驗證處理
- [ ] 分類選項一致性管理
- [ ] 狀態切換業務規則
- [ ] 權限控制實作
- [ ] 審計追蹤功能

### 完成度確認
- [x] 查詢功能完整 (含分頁、排序、篩選)
- [x] 新增功能完整 (含驗證、錯誤處理)  
- [x] 編輯功能完整 (含資料載入、關聯性檢查)
- [x] 檢視功能完整 (含動態課程活動載入)
- [x] 單筆刪除功能完整 (含確認機制)
- [x] 批量刪除功能完整 (含批量確認)
- [x] 狀態切換功能完整 (含確認機制)
- [x] 匯出功能完整
- [ ] 匯入功能完整 (含檔案驗證、範例下載) - 暫未實作
- [ ] 單元測試完成
- [ ] 整合測試完成

### 🆕 新增實作功能
- [x] **動態選項載入**: learningType, skillType, level 選項完全從後端動態載入
- [x] **模態視窗架構**: 新增/編輯/檢視統一使用模態視窗，提升使用體驗
- [x] **三態顯示邏輯**: loading → error → success 完整狀態處理
- [x] **課程活動整合**: 與 course-event-management 模組完整整合
- [x] **共用元件**: 大量使用 shared components (15+ 個組件)
- [x] **權限控制**: 與 UserStore 整合的完整權限管理
- [x] **無障礙支援**: 完整的 ARIA 標籤和鍵盤導航
- [x] **效能優化**: 使用 @defer 和 trackBy 優化列表渲染

---

## 🔄 特殊業務規則

### 課程活動關聯性
- 課程必須隸屬於有效的課程活動
- 課程的年度和半年度必須與關聯課程活動一致
- 刪除課程活動時需檢查是否有關聯的課程

### 分類管理
- 技術類別、等級、上課方式採用預定義選項
- 支援未來擴充新的分類選項
- 確保分類選項的一致性和有效性

### 狀態管理
- 停用的課程不影響歷史學習記錄
- 狀態切換需要適當權限
- 提供狀態變更歷史追蹤

### 權限控制
- 一般使用者：查詢功能
- 管理者：完整 CRUD 操作
- 系統管理員：所有功能含狀態管理

### 資料完整性
- 課程名稱支援長文字內容 (TEXT 類型)
- 備註欄位限制 255 字元
- 自動記錄建檔和更新的時間與人員
