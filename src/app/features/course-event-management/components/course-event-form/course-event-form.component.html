<app-base-modal [config]="modalConfig()" [loading]="loading()" [show]="true" (closed)="onCancel()"
    (backdropClicked)="onCancel()">

    <!-- 表單內容 -->
    <form id="courseEventForm" [formGroup]="form" (ngSubmit)="onSubmit()" novalidate slot="body">
        <!-- 錯誤訊息 -->
        <app-error-alert [error]="error()" (clearError)="clearError()"></app-error-alert>

        <div class="row g-3">
            <!-- 年度 -->
            <div class="col-md-6">
                <app-form-field fieldId="year" label="年度" icon="bi bi-calendar4-range" [required]="true"
                    [error]="getFieldError('year')">
                    <select id="year" class="form-select" [class.is-invalid]="isFieldInvalid('year')"
                        formControlName="year" aria-describedby="year_help year_error">
                        <option value="">請選擇年度</option>
                        @for (yearOption of yearOptions(); track yearOption.value) {
                        <option [value]="yearOption.value">{{ yearOption.label }}</option>
                        }
                    </select>
                </app-form-field>
            </div>

            <!-- 上/下半年 -->
            <div class="col-md-6">
                <app-form-field fieldId="semester" label="上/下半年" icon="bi bi-calendar3" [required]="true"
                    [error]="getFieldError('semester')">
                    <select id="semester" class="form-select" [class.is-invalid]="isFieldInvalid('semester')"
                        formControlName="semester" aria-describedby="semester_help semester_error">
                        <option value="">請選擇上/下半年</option>
                        @for (semesterOption of semesterOptions; track semesterOption.value) {
                        <option [value]="semesterOption.value">{{ semesterOption.label }}</option>
                        }
                    </select>
                </app-form-field>
            </div>

            <!-- 活動標題 -->
            <div class="col-12">
                <app-form-field fieldId="activityTitle" label="活動標題" icon="bi bi-card-heading" [required]="true"
                    [error]="getFieldError('activityTitle')">
                    <input id="activityTitle" type="text" class="form-control"
                        [class.is-invalid]="isFieldInvalid('activityTitle')" formControlName="activityTitle"
                        placeholder="請輸入活動標題" maxlength="200" aria-describedby="activityTitle_help activityTitle_error">
                </app-form-field>
            </div>

            <!-- 活動描述 -->
            <div class="col-12">
                <app-form-field fieldId="description" label="活動描述" icon="bi bi-text-paragraph"
                    [error]="getFieldError('description')">
                    <textarea id="description" class="form-control" rows="4"
                        [class.is-invalid]="isFieldInvalid('description')" formControlName="description"
                        placeholder="請輸入活動描述（選填）" maxlength="1000"
                        aria-describedby="description_help description_error"></textarea>
                </app-form-field>
            </div>

            <!-- 預期完成日期 -->
            <div class="col-md-4">
                <app-form-field fieldId="expectedCompletionDate" label="預期完成日期" icon="bi bi-calendar-check"
                    [required]="true" [error]="getFieldError('expectedCompletionDate')" helpText="各主管安排課程的預計完成日">
                    <input id="expectedCompletionDate" type="date" class="form-control"
                        [class.is-invalid]="isFieldInvalid('expectedCompletionDate')"
                        formControlName="expectedCompletionDate"
                        aria-describedby="expectedCompletionDate_help expectedCompletionDate_error">
                </app-form-field>
            </div>

            <!-- 提交截止日期 -->
            <div class="col-md-4">
                <app-form-field fieldId="submissionDeadline" label="提交截止日期" icon="bi bi-calendar-x" [required]="true"
                    [error]="getFieldError('submissionDeadline')" helpText="對公司提交課程人員的截止日">
                    <input id="submissionDeadline" type="date" class="form-control"
                        [class.is-invalid]="isFieldInvalid('submissionDeadline')" formControlName="submissionDeadline"
                        aria-describedby="submissionDeadline_help submissionDeadline_error">
                </app-form-field>
            </div>

            <!-- 啟動日期 -->
            <div class="col-md-4">
                <app-form-field fieldId="activationDate" label="啟動日期" icon="bi bi-calendar-plus" [required]="true"
                    [error]="getFieldError('activationDate')">
                    <input id="activationDate" type="date" class="form-control"
                        [class.is-invalid]="isFieldInvalid('activationDate')" formControlName="activationDate"
                        aria-describedby="activationDate_help activationDate_error">
                </app-form-field>
            </div>

            <!-- 啟用狀態 -->
            <div class="col-12">
                <app-form-field fieldId="isActive" label="啟用狀態" icon="bi bi-toggle-on" [required]="true"
                    [error]="getFieldError('isActive')">
                    <select id="isActive" class="form-select" [class.is-invalid]="isFieldInvalid('isActive')"
                        formControlName="isActive" aria-describedby="isActive_help isActive_error">
                        <option value="true">啟用</option>
                        <option value="false">停用</option>
                    </select>
                </app-form-field>
            </div>
        </div>

        <!-- 系統欄位說明（編輯模式） -->
        @if (isEditMode() && entity()) {
        <div class="system-fields mt-4">
            <h6 class="text-muted mb-3">
                <i class="bi bi-info-circle me-1"></i>
                系統資訊
            </h6>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label text-muted">課程活動ID</label>
                    <div class="form-control-plaintext">{{ entity()?.courseEventId || 'N/A' }}</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted">建立時間</label>
                    <div class="form-control-plaintext">{{ entity()?.createTime || 'N/A' }}</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted">最後更新</label>
                    <div class="form-control-plaintext">{{ entity()?.updateTime || 'N/A' }}</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted">更新者</label>
                    <div class="form-control-plaintext">{{ entity()?.updateUser || 'N/A' }}</div>
                </div>
            </div>
        </div>
        }
    </form>

    <!-- 按鈕區域 -->
    <div slot="footer">
        <app-form-buttons [loading]="loading()" [submitDisabled]="form.invalid" [submitButtonText]="submitButtonText()"
            formId="courseEventForm" (cancelled)="onCancel()">
        </app-form-buttons>
    </div>
</app-base-modal>